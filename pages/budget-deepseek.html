<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‹¤êµ­ì–´ ì˜ˆì‚° ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #4895ef;
      --danger: #f72585;
      --success: #4cc9f0;
      --warning: #f8961e;
      --info: #7209b7;
      --text-color: #2b2d42;
      --light-gray: #f8f9fa;
      --medium-gray: #adb5bd;
      --dark-gray: #495057;
      --white: #ffffff;
      --shadow: 0 4px 16px rgba(67,97,238,0.08);
      --border-radius: 12px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
      color: var(--text-color);
      background: var(--light-gray);
      padding: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 1100px;
      margin: 40px auto 40px auto;
      padding: 24px 18px 36px 18px;
      background: var(--white);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      box-sizing: border-box;
    }
    .language-switcher {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-bottom: 10px;
      position: relative;
      z-index: 10;
    }
    .language-btn {
      background: #fff;
      color: var(--primary);
      border: 1.5px solid var(--primary);
      border-radius: 18px;
      padding: 8px 22px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(67,97,238,0.06);
    }
    .language-btn.active {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 4px 12px rgba(67,97,238,0.14);
    }
    header {
      text-align: center;
      margin-bottom: 32px;
    }
    h1 { color: var(--primary); font-size: 2.2rem; margin-bottom: 12px; }
    h2 { color: var(--primary); font-size: 1.3rem; margin-bottom: 14px; }
    .card {
      background: var(--white);
      padding: 22px 18px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      margin-bottom: 24px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 18px;
    }
    .form-group { margin-bottom: 16px; }
    label {
      display: block;
      margin-bottom: 7px;
      font-weight: 600;
      color: var(--dark-gray);
    }
    input, select {
      width: 100%;
      padding: 11px;
      border: 1px solid var(--medium-gray);
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: border-color 0.2s;
      background: #f7faff;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.12);
    }
    button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 11px 18px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.18s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(67,97,238,0.07);
    }
    button:hover { background-color: var(--primary-light); }
    .btn-danger { background-color: var(--danger); }
    .btn-danger:hover { background-color: #d6336c; }
    .btn-warning { background-color: var(--warning); }
    .btn-warning:hover { background-color: #e67700; }
    .btn-success { background-color: var(--success); color: var(--text-color);}
    .btn-success:hover { background-color: #339af0; color: #fff;}
    .btn-info { background-color: var(--info);}
    .btn-info:hover { background-color: #5f3dc4;}
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 16px;
      font-size: 0.92rem;
      font-weight: 600;
      background-color: var(--primary-light);
      color: white;
      margin-right: 4px;
    }
    .item-list { margin-top: 12px; }
    .list-item {
      background: var(--white);
      padding: 13px 10px;
      margin-bottom: 8px;
      border-radius: var(--border-radius);
      box-shadow: 0 1px 3px rgba(0,0,0,0.07);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }
    .list-item:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    .list-item-content {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    .list-item-amount { font-weight: 600; min-width: 82px; text-align: right; }
    .list-item-actions { display: flex; gap: 5px; }
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 23px;
    }
    .summary-card {
      background: var(--white);
      padding: 18px 0 16px 0;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      text-align: center;
      border-top: 4px solid var(--primary);
    }
    .card-label { font-size: 0.96rem; color: var(--medium-gray); margin-bottom: 2px; }
    .card-amount { font-size: 1.7rem; font-weight: 700; margin: 9px 0; }
    .positive { color: var(--success);}
    .negative { color: var(--danger);}
    .flow-item {
      display: flex;
      justify-content: space-between;
      padding: 13px 10px;
      margin: 7px 0;
      background: var(--white);
      border-radius: var(--border-radius);
      box-shadow: 0 1px 2px rgba(0,0,0,0.07);
      font-size: 1.05rem;
    }
    .flow-item.highlighted { border-left: 4px solid var(--danger);}
    .flow-item.result { border-left: 4px solid var(--success); font-weight: bold;}
    .flow-item.info { border-left: 4px solid var(--warning); font-weight: bold;}
    .flow-arrow {
      text-align: center;
      color: var(--medium-gray);
      margin: 5px 0;
      font-size: 1.18rem;
    }
    .chart-container {
      background: var(--white);
      padding: 18px 12px 24px 12px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      margin-top: 5px;
      height: 420px;
      position: relative;
    }
    .chart-wrapper {
      width: 100%;
      height: 340px;
      position: relative;
    }
    .chart-title {
      text-align: center;
      margin-bottom: 12px;
      color: var(--primary);
      font-size: 1.1rem;
      font-weight: 700;
    }
    .utility-buttons {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin: 28px 0 8px 0;
      flex-wrap: wrap;
    }
    .hidden { display: none;}
    .flex { display: flex; gap: 12px; align-items: flex-end;}
    .flex > div { flex: 1;}
    @media (max-width: 900px) {
      .container { margin: 18px 3px;}
      .chart-container { height: 320px;}
      .chart-wrapper { height: 220px;}
    }
    @media (max-width: 600px) {
      .container { padding: 8px 2px;}
      .summary-cards { grid-template-columns: 1fr;}
      .chart-container { height: 260px;}
      .chart-wrapper { height: 140px;}
      .language-switcher { justify-content: center;}
    }
    @media print {
      body { padding: 0; background: white;}
      button, .utility-buttons, .language-switcher { display: none;}
      .card, .chart-container { box-shadow: none; border: 1px solid #ddd; page-break-inside: avoid;}
      .chart-container { height: auto;}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ì–¸ì–´ ì „í™˜ ë²„íŠ¼ -->
    <div class="language-switcher">
      <button id="lang-ko" class="language-btn active">í•œêµ­ì–´</button>
      <button id="lang-en" class="language-btn">English</button>
    </div>
    <header>
      <h1 data-lang="ko">ğŸ’° ê³ ê¸‰ ì˜ˆì‚° ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
      <h1 data-lang="en" class="hidden">ğŸ’° Advanced Budget Management System</h1>
      <p data-lang="ko">í•œ ê³³ì—ì„œ ìˆ˜ì…, ì„¸ê¸ˆ, ê³µì œ ë° ì§€ì¶œì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
      <p data-lang="en" class="hidden">Manage your income, taxes, deductions, and expenses in one place</p>
    </header>

    <!-- ì´í•˜ ê¸°ì¡´ ì„¹ì…˜ ì½”ë“œ ë™ì¼í•˜ê²Œ ìœ ì§€ (ì…ë ¥í¼/ì§€ì¶œ/ì°¨íŠ¸ ë“±) -->
    <!-- ... (ì´í•˜ ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼) ... -->
    <!-- ìˆ˜ì…/ì„¸ê¸ˆ/ê³µì œ/ì§€ì¶œ/ì›”ë³„í˜„í™©/ì°¨íŠ¸/ìœ í‹¸ë²„íŠ¼ ì „ì²´ í¬í•¨ -->
    <!-- ì½”ë“œê°€ ê¸¸ì–´ì§€ë¯€ë¡œ, ì§ˆë¬¸ì— ì²¨ë¶€í•´ì£¼ì‹  htmlì˜ ë³¸ë¬¸ ë¶€ë¶„ ê·¸ëŒ€ë¡œ ì“°ì‹œë©´ ë˜ê³ , ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ ë¶€ë¶„ë§Œ ì „ì²´ êµì²´í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. -->

    <!-- (ë³¸ë¬¸ì€ ë™ì¼) -->
    <!-- ... -->

    <!-- â˜…â˜…â˜… SCRIPT ë¶€ë¶„ ì „ì²´ êµì²´ (ì•„ë˜ ì½”ë“œë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”) â˜…â˜…â˜… -->
    <script>
    // ì„¤ì •ê°’
    const DEFAULT_DEDUCTIONS = {
      taxes: [
        { name: "Federal Withholding", amount: 0 },
        { name: "State Tax (CA)", amount: 0 },
        { name: "OASDI (Social Security)", amount: 0 },
        { name: "Medicare", amount: 0 },
        { name: "CA SDI", amount: 0 }
      ],
      preTax: [
        { name: "401k Traditional", amount: 0 },
        { name: "Medical Premium", amount: 0 },
        { name: "Dental Premium", amount: 0 },
        { name: "Vision Premium", amount: 0 },
        { name: "MSEAP", amount: 0 }
      ],
      postTax: [
        { name: "401k Roth", amount: 0 },
        { name: "Stock Purchase Plan", amount: 0 },
        { name: "Legal Services", amount: 0 },
        { name: "LTD", amount: 0 },
        { name: "AD&D", amount: 0 },
        { name: "Accident Insurance", amount: 0 },
        { name: "Critical Illness", amount: 0 }
      ]
    };
    const budgetData = {
      income: 0,
      taxes: [],
      preTax: [],
      postTax: [],
      expenses: [],
      categories: [
        { id: 'housing', name: 'ğŸ  ì£¼ê±°', nameEn: 'ğŸ  Housing' },
        { id: 'food', name: 'ğŸ” ì‹ë¹„', nameEn: 'ğŸ” Food' },
        { id: 'transportation', name: 'ğŸš— êµí†µ', nameEn: 'ğŸš— Transportation' },
        { id: 'health', name: 'ğŸ¥ ê±´ê°•', nameEn: 'ğŸ¥ Health' },
        { id: 'family', name: 'ğŸ‘ª ê°€ì¡±', nameEn: 'ğŸ‘ª Family' },
        { id: 'shopping', name: 'ğŸ›ï¸ ì‡¼í•‘', nameEn: 'ğŸ›ï¸ Shopping' },
        { id: 'finance', name: 'ğŸ’³ ê¸ˆìœµ', nameEn: 'ğŸ’³ Finance' },
        { id: 'travel', name: 'âœˆï¸ ì—¬í–‰', nameEn: 'âœˆï¸ Travel' },
        { id: 'saving', name: 'ğŸ’° ì €ì¶•', nameEn: 'ğŸ’° Saving' },
        { id: 'business', name: 'ğŸ’¼ ì—…ë¬´', nameEn: 'ğŸ’¼ Business' }
      ],
      currentLanguage: 'ko'
    };
    let incomeFlowChartInstance = null;
    let expenseCategoryChartInstance = null;
    let editingItem = null;

    // util
    function generateUniqueId() { return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);}
    function formatMoney(amount) { if(isNaN(amount)||amount==null)return"0.00";return parseFloat(amount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",");}
    function calculatePercentage(value, total) { if(total===0)return"0.0%";return((value/total)*100).toFixed(1)+'%';}

    // ì–¸ì–´ì „í™˜
    function switchLanguage(lang) {
      budgetData.currentLanguage = lang;
      document.querySelectorAll('[data-lang]').forEach(e=>{
        if(e.getAttribute('data-lang')===lang) e.classList.remove('hidden');
        else e.classList.add('hidden');
      });
      document.getElementById('lang-ko').classList.toggle('active', lang==='ko');
      document.getElementById('lang-en').classList.toggle('active', lang==='en');
      populateCategorySelect();
      updateUI();
    }

    // ì¹´í…Œê³ ë¦¬ ì…€ë ‰íŠ¸
    function populateCategorySelect() {
      const select = document.getElementById('category');
      const prev = select.value;
      select.innerHTML = '';
      budgetData.categories.forEach(cat=>{
        const o=document.createElement('option');
        o.value=cat.id;
        o.textContent=budgetData.currentLanguage==='ko'?cat.name:cat.nameEn||cat.name;
        select.appendChild(o);
      });
      const c=document.createElement('option');
      c.value='custom';
      c.textContent=budgetData.currentLanguage==='ko'?'âœï¸ ì§ì ‘ ì…ë ¥':'âœï¸ Custom Category';
      select.appendChild(c);
      if(budgetData.categories.some(cat=>cat.id===prev)||prev==='custom')select.value=prev;
      else select.value=budgetData.categories[0]?budgetData.categories[0].id:'';
    }

    // ì°¨íŠ¸
    function updateCharts(grossIncome, preTaxTotal, taxTotal, postTaxTotal, expensesTotal, remaining) {
      if(incomeFlowChartInstance) incomeFlowChartInstance.destroy();
      if(expenseCategoryChartInstance) expenseCategoryChartInstance.destroy();
      // ìˆ˜ì… ë¶„ë°° ì°¨íŠ¸
      const ctx1=document.getElementById('incomeFlowChart').getContext('2d');
      incomeFlowChartInstance = new Chart(ctx1, {
        type:'doughnut',
        data: {
          labels: [
            budgetData.currentLanguage==='ko'?'ì„¸ì „ê³µì œ':'Pre-Tax',
            budgetData.currentLanguage==='ko'?'ì„¸ê¸ˆ':'Taxes',
            budgetData.currentLanguage==='ko'?'ì„¸í›„ê³µì œ':'Post-Tax',
            budgetData.currentLanguage==='ko'?'ì§€ì¶œ':'Expenses',
            budgetData.currentLanguage==='ko'?'ì”ì•¡':'Balance'
          ],
          datasets: [{
            data: [preTaxTotal, taxTotal, postTaxTotal, expensesTotal, remaining>0?remaining:0],
            backgroundColor: ['#4895ef','#f72585','#4cc9f0','#f8961e','#43aa8b']
          }]
        },
        options: {
          plugins: {
            legend: { position: 'bottom', labels:{font:{size:13}} }
          }
        }
      });
      // ì§€ì¶œ ì¹´í…Œê³ ë¦¬
      const ctx2=document.getElementById('expenseCategoryChart').getContext('2d');
      const categoryTotals={};
      budgetData.expenses.forEach(item=>{
        const cat=budgetData.categories.find(c=>c.id===item.category);
        const label=budgetData.currentLanguage==='ko'?(cat?.name||'ê¸°íƒ€'):(cat?.nameEn||cat?.name||'Other');
        if(!categoryTotals[label])categoryTotals[label]=0;
        categoryTotals[label]+=item.amount;
      });
      expenseCategoryChartInstance=new Chart(ctx2,{
        type:'pie',
        data:{
          labels:Object.keys(categoryTotals),
          datasets:[{
            data:Object.values(categoryTotals),
            backgroundColor:['#4895ef','#f72585','#4cc9f0','#f8961e','#7209b7','#b5179e','#43aa8b','#ffd60a','#b5ead7','#ffdac1']
          }]
        },
        options:{
          plugins:{legend:{position:'bottom',labels:{font:{size:13}}}}
        }
      });
    }

    // UI ì—…ë°ì´íŠ¸
    function updateUI() {
      localStorage.setItem('budgetData', JSON.stringify(budgetData));
      const gross=budgetData.income;
      const pretax=budgetData.preTax.reduce((s,i)=>s+i.amount,0);
      const tax=budgetData.taxes.reduce((s,i)=>s+i.amount,0);
      const posttax=budgetData.postTax.reduce((s,i)=>s+i.amount,0);
      const totalDeduct=pretax+tax+posttax;
      const taxable=gross-pretax;
      const net=taxable-tax-posttax;
      const expenses=budgetData.expenses.reduce((s,i)=>s+i.amount,0);
      const remain=net-expenses;
      document.querySelectorAll('#income').forEach(input=>{
        if(input.getAttribute('data-lang')===budgetData.currentLanguage||!input.hasAttribute('data-lang'))input.value=gross;
      });
      document.getElementById('gross-income').textContent=formatMoney(gross);
      document.getElementById('pre-tax-deductions').textContent=formatMoney(pretax);
      document.getElementById('taxable-income').textContent=formatMoney(taxable);
      document.getElementById('tax-total').textContent=formatMoney(tax);
      document.getElementById('post-tax-deductions').textContent=formatMoney(posttax);
      document.getElementById('total-deductions-taxes').textContent=formatMoney(totalDeduct);
      document.getElementById('net-income').textContent=formatMoney(net);
      document.getElementById('expenses-total-card').textContent=formatMoney(expenses);
      document.getElementById('remaining-balance').textContent=formatMoney(remain);
      const re=document.getElementById('remaining-balance');
      re.className=`card-amount ${remain>=0?'positive':'negative'}`;
      document.getElementById('expenses-percentage-card').textContent=calculatePercentage(expenses,gross);
      document.getElementById('remaining-percentage-card').textContent=calculatePercentage(remain,gross);
      renderList('tax-list',budgetData.taxes,gross);
      renderList('pre-tax-list',budgetData.preTax,gross);
      renderList('post-tax-list',budgetData.postTax,gross);
      renderExpenses(gross);
      populateCategorySelect();
      updateCharts(gross,pretax,tax,posttax,expenses,remain);
    }
    function renderList(elementId,items,totalIncome){
      const container=document.getElementById(elementId);
      const type=elementId.replace('-list','');
      container.innerHTML=items.map(item=>`
        <div class="list-item" data-id="${item.id}" data-type="${type}">
          ${editingItem&&editingItem.id===item.id?
           `<div class="list-item-content">
              <input type="text" value="${item.name}" id="edit-name-${item.id}" placeholder="${budgetData.currentLanguage==='ko'?'í•­ëª©ëª…':'Item name'}">
              <input type="number" value="${item.amount}" id="edit-amount-${item.id}" placeholder="${budgetData.currentLanguage==='ko'?'ê¸ˆì•¡':'Amount'}">
            </div>
            <div class="list-item-actions">
              <button onclick="saveEdit('${type}','${item.id}')" class="btn-success">${budgetData.currentLanguage==='ko'?'ì €ì¥':'Save'}</button>
              <button onclick="cancelEdit()" class="btn-warning">${budgetData.currentLanguage==='ko'?'ì·¨ì†Œ':'Cancel'}</button>
            </div>`
           :
           `<div class="list-item-content">
              <span>${item.name}: $${formatMoney(item.amount)}</span>
            </div>
            <div class="list-item-actions">
              <button onclick="editItem('${type}','${item.id}')" class="btn-info">${budgetData.currentLanguage==='ko'?'ìˆ˜ì •':'Edit'}</button>
              <button onclick="deleteItem('${type}','${item.id}')" class="btn-danger">${budgetData.currentLanguage==='ko'?'ì‚­ì œ':'Delete'}</button>
            </div>`
          }
        </div>
      `).join('');
    }
    function renderExpenses(totalIncome){
      const container=document.getElementById('expenses-list');
      container.innerHTML=budgetData.expenses.map(item=>{
        const category=budgetData.categories.find(cat=>cat.id===item.category);
        const categoryName=budgetData.currentLanguage==='ko'?category?.name:category?.nameEn||category?.name||'Other';
        return `
          <div class="list-item" data-id="${item.id}" data-type="expenses">
            ${editingItem&&editingItem.id===item.id?
              `<div class="list-item-content">
                 <select id="edit-category-${item.id}" style="margin-right:7px;">
                   ${budgetData.categories.map(cat=>`
                     <option value="${cat.id}" ${cat.id===item.category?'selected':''}>
                       ${budgetData.currentLanguage==='ko'?cat.name:cat.nameEn||cat.name}
                     </option>
                   `).join('')}
                 </select>
                 <input type="text" value="${item.name}" id="edit-name-${item.id}" placeholder="${budgetData.currentLanguage==='ko'?'í•­ëª©ëª…':'Item name'}">
                 <input type="number" value="${item.amount}" id="edit-amount-${item.id}" placeholder="${budgetData.currentLanguage==='ko'?'ê¸ˆì•¡':'Amount'}">
               </div>
               <div class="list-item-actions">
                 <button onclick="saveEdit('expenses','${item.id}')" class="btn-success">${budgetData.currentLanguage==='ko'?'ì €ì¥':'Save'}</button>
                 <button onclick="cancelEdit()" class="btn-warning">${budgetData.currentLanguage==='ko'?'ì·¨ì†Œ':'Cancel'}</button>
               </div>`
              :
              `<div class="list-item-content">
                 <span class="badge">${categoryName||'ğŸ“Œ '+(budgetData.currentLanguage==='ko'?'ê¸°íƒ€':'Other')}</span>
                 <span>${item.name}</span>
               </div>
               <span class="list-item-amount">$${formatMoney(item.amount)}</span>
               <div class="list-item-actions">
                 <button onclick="editItem('expenses','${item.id}')" class="btn-info">${budgetData.currentLanguage==='ko'?'ìˆ˜ì •':'Edit'}</button>
                 <button onclick="deleteItem('expenses','${item.id}')" class="btn-danger">${budgetData.currentLanguage==='ko'?'ì‚­ì œ':'Delete'}</button>
               </div>`
            }
          </div>
        `;
      }).join('');
    }

    // CRUD
    function deleteItem(type,id){
      if(confirm(budgetData.currentLanguage==='ko'?'ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?':'Are you sure you want to delete this item?')){
        budgetData[type]=budgetData[type].filter(item=>item.id!==id);updateUI();
      }
    }
    function editItem(type,id){
      cancelEdit();
      const item=budgetData[type].find(item=>item.id===id);
      if(item){editingItem={...item,type:type};updateUI();}
    }
    function saveEdit(type,id){
      const idx=budgetData[type].findIndex(item=>item.id===id);
      if(idx===-1)return;
      const newName=document.getElementById(`edit-name-${id}`).value.trim();
      const newAmount=parseFloat(document.getElementById(`edit-amount-${id}`).value);
      if(!newName){alert(budgetData.currentLanguage==='ko'?'í•­ëª©ëª…ì€ ë¹„ì›Œë‘˜ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.':'Item name cannot be empty.');return;}
      if(isNaN(newAmount)){alert(budgetData.currentLanguage==='ko'?'ìœ íš¨í•œ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.':'Please enter a valid amount.');return;}
      budgetData[type][idx].name=newName;budgetData[type][idx].amount=newAmount;
      if(type==='expenses'){
        const newCategory=document.getElementById(`edit-category-${id}`).value;
        budgetData[type][idx].category=newCategory;
      }
      editingItem=null;updateUI();
    }
    function cancelEdit(){editingItem=null;updateUI();}

    // ë°ì´í„° ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
    function saveData(){localStorage.setItem('budgetData',JSON.stringify(budgetData));alert(budgetData.currentLanguage==='ko'?'ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.':'Data saved!');}
    function loadData(){
      const d=localStorage.getItem('budgetData');
      if(d){
        const parsed=JSON.parse(d);
        Object.assign(budgetData,parsed);
        if(!budgetData.categories)budgetData.categories=[
          { id: 'housing', name: 'ğŸ  ì£¼ê±°', nameEn: 'ğŸ  Housing' },
          { id: 'food', name: 'ğŸ” ì‹ë¹„', nameEn: 'ğŸ” Food' },
          { id: 'transportation', name: 'ğŸš— êµí†µ', nameEn: 'ğŸš— Transportation' },
          { id: 'health', name: 'ğŸ¥ ê±´ê°•', nameEn: 'ğŸ¥ Health' },
          { id: 'family', name: 'ğŸ‘ª ê°€ì¡±', nameEn: 'ğŸ‘ª Family' },
          { id: 'shopping', name: 'ğŸ›ï¸ ì‡¼í•‘', nameEn: 'ğŸ›ï¸ Shopping' },
          { id: 'finance', name: 'ğŸ’³ ê¸ˆìœµ', nameEn: 'ğŸ’³ Finance' },
          { id: 'travel', name: 'âœˆï¸ ì—¬í–‰', nameEn: 'âœˆï¸ Travel' },
          { id: 'saving', name: 'ğŸ’° ì €ì¶•', nameEn: 'ğŸ’° Saving' },
          { id: 'business', name: 'ğŸ’¼ ì—…ë¬´', nameEn: 'ğŸ’¼ Business' }
        ];
      } else {
        initDefaultData();
      }
      updateUI();
    }
    function resetData(){
      if(confirm(budgetData.currentLanguage==='ko'?'ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?':'Reset all data?')){
        localStorage.removeItem('budgetData');
        initDefaultData();
        updateUI();
      }
    }
    function initDefaultData(){
      budgetData.taxes=DEFAULT_DEDUCTIONS.taxes.map(item=>({...item,id:generateUniqueId(),type:'taxes'}));
      budgetData.preTax=DEFAULT_DEDUCTIONS.preTax.map(item=>({...item,id:generateUniqueId(),type:'preTax'}));
      budgetData.postTax=DEFAULT_DEDUCTIONS.postTax.map(item=>({...item,id:generateUniqueId(),type:'postTax'}));
      budgetData.income=0;budgetData.expenses=[];
      localStorage.setItem('budgetData',JSON.stringify(budgetData));
    }

    // ì´ë²¤íŠ¸ ì—°ê²°
    document.getElementById('lang-ko').onclick=()=>switchLanguage('ko');
    document.getElementById('lang-en').onclick=()=>switchLanguage('en');
    window.onload=function(){loadData();updateUI();switchLanguage(budgetData.currentLanguage||'ko');}

    // ì…ë ¥ ì´ë²¤íŠ¸ ì—°ê²°(í•„ìš”ì‹œ ì§ì ‘ ì—°ê²°)
    document.addEventListener('input',function(e){
      if(e.target.id==='income'){budgetData.income=parseFloat(e.target.value)||0;updateUI();}
    });

    // ê¸°íƒ€ í•¨ìˆ˜(ì§€ì¶œ/ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ë“±) ë³¸ë¬¸ì— ìˆë˜ í•¨ìˆ˜ ìœ ì§€ ì‚¬ìš©í•˜ì„¸ìš”.
    // ... (addExpense, addCategory ë“± ê¸°ì¡´ í•¨ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ)
    </script>
    <!-- â˜…â˜…â˜… SCRIPT ë â˜…â˜…â˜… -->
  </div>
</body>
</html>
